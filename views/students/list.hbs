<div class="container-xl">
  <div class="alert alert-success hidden alert-dismissible fade in">
    <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
    <strong>Success!</strong> This alert box could indicate a successful or positive action.
  </div>
  <div class="alert alert-info hidden alert-dismissible fade in">
    <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
    <strong>Info!</strong> This alert box could indicate a neutral informative change or action.
  </div>
  <div class="alert alert-warning hidden alert-dismissible fade in">
    <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
    <strong>Warning!</strong> This alert box could indicate a warning that might need attention.
  </div>
  <div class="alert alert-danger hidden alert-dismissible fade in">
    <a href="#" class="close" data-dismiss="alert" aria-label="close">&times;</a>
    <strong>Danger!</strong> This alert box could indicate a dangerous or potentially negative action.
  </div>

  <div class="table-responsive" id="studentList">
    <div class="table-wrapper">
      <div class="table-title">
        <div class="row">
          <div class="col-sm-6">
            <h2>Manage <b>Students</b></h2>
          </div>
          <div class="col-sm-6">
            <a href="#addStudentModal" class="btn btn-success" data-toggle="modal"><i
                class="material-icons">&#xE147;</i> <span>Add New Student</span></a>
            <a href="#" class="btn btn-danger deleteStudentModal" data-toggle="modal"><i
                class="material-icons">&#xE15C;</i> <span>Delete</span></a>
          </div>
        </div>
      </div>
      <table class="table table-striped table-hover">
        <thead>
          <tr>
            <th>
              <span class="custom-checkbox">
                <input type="checkbox" id="selectAll">
                <label for="selectAll"></label>
              </span>
            </th>
            <th>Index</th>
            <th>Name</th>
            <th>Gender</th>
            <th>Address</th>
            <th>Phone</th>
            <th>Actions</th>
          </tr>
        </thead>
        <tbody id="studentRow">
          {{#each students}}
          <tr class="row{{_id}}">
            <th>
              <span class="custom-checkbox">
                <input type="checkbox" class="deleteAll" value="{{_id}}">
                <label for="deleteAll"></label>
              </span>
            </th>
            <td>{{math @index "+" 1}}</td>
            <td>{{firstName}}</td>
            <td> {{gender}} </td>
            <td>{{address}}</td>
            <td>{{phone}}</td>
            <td>
              <a href="#editStudentModal" class="editModelShow" data-id="{{_id}}" class="edit" data-toggle="modal"><i
                  class="material-icons" data-toggle="tooltip" title="Edit">&#xE254;</i></a>
              <a href="#" class="deleteModelShow" data-id="{{_id}}"><i class="material-icons" data-toggle="tooltip"
                  title="Delete">&#xE872;</i></a>
            </td>
          </tr>
          {{else}}
          <tr>
            <td colspan="5">
              No Records found
            </td>
          </tr>
          {{/each}}
        </tbody>
      </table>
      {{!-- <div class="clearfix">
        <div class="hint-text">Showing <b>5</b> out of <b>25</b> entries</div>
        <ul class="pagination">
          <li class="page-item disabled"><a href="#">Previous</a></li>
          <li class="page-item"><a href="#" class="page-link">1</a></li>
          <li class="page-item"><a href="#" class="page-link">2</a></li>
          <li class="page-item active"><a href="#" class="page-link">3</a></li>
          <li class="page-item"><a href="#" class="page-link">4</a></li>
          <li class="page-item"><a href="#" class="page-link">5</a></li>
          <li class="page-item"><a href="#" class="page-link">Next</a></li>
        </ul>
      </div> --}}
      <div class="clearfix">
        {{{paginateHelper pagination leftText="Prev" rightText="Next" firstText="First" lastText="Last"}}}
      </div>
    </div>
  </div>
</div>
<!-- Edit Modal HTML -->
<div id="addStudentModal" class="modal fade">
  <div class="modal-dialog">
    <div class="modal-content">
      <form id="addStudentModalForm" method="POST">
        <div class="modal-header">
          <h4 class="modal-title">Add Student</h4>
          <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        </div>
        <div class="modal-body">
          <div class="form-group">
            <label>Name</label>
            <input type="text" name="firstName" class="form-control" required>
          </div>
          <div class="form-group">
            <label>Father Name</label>
            <input type="text" name="fatherName" class="form-control" required>
          </div>
          <div class="form-group">
            <label>Mother Name</label>
            <input type="text" name="motherName" class="form-control" required>
          </div>
          <div class="form-group">
            <label>Gender</label>
            <br />
            <input type="radio" value="male" name="gender" class="form-control" required>Male
            &nbsp;
            <input type="radio" value="female" name="gender" class="form-control" required>Female
          </div>
          <div class="form-group">
            <label>Profile Photo</label>
            <input class="form-control" name="profilePhoto" id="profilePhoto" type="file">
          </div>
          <div class="form-group">
            <label>Address</label>
            <textarea class="form-control" name="address" required></textarea>
          </div>
          <div class="form-group">
            <label>Phone</label>
            <input type="text" name="phone" class="form-control" required>
          </div>
        </div>
        <div class="modal-footer">
          <input type="button" class="btn btn-default" data-dismiss="modal" value="Cancel">
          <input type="submit" class="btn btn-success" value="Add">
        </div>
      </form>
    </div>
  </div>
</div>
<!-- Edit Modal HTML -->
<div id="editStudentModal" class="modal fade">
  <div class="modal-dialog">
    <div class="modal-content">
      <form id="editStudentModalForm" method="POST">
        <div class="modal-header">
          <h4 class="modal-title">Edit Student</h4>
          <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        </div>
        <div class="modal-body">
          <input type="hidden" name="stdId">
          <div class="form-group">
            <label>Name</label>
            <input type="text" name="firstName" class="form-control" required>
          </div>
          <div class="form-group">
            <label>Father Name</label>
            <input type="text" name="fatherName" class="form-control" required>
          </div>
          <div class="form-group">
            <label>Mother Name</label>
            <input type="text" name="motherName" class="form-control" required>
          </div>
          <div class="form-group">
            <label>Gender</label>
            <br />
            <input type="radio" value="male" name="gender" class="form-control" required>Male
            &nbsp;
            <input type="radio" value="female" name="gender" class="form-control" required>Female
          </div>
          <div class="form-group">
            <label>Profile Photo</label>
            <img name="profilePhoto" height="50" width="50">
            <input class="form-control" name="profilePhoto" id="profilePhoto2" type="file">
          </div>
          <div class="form-group">
            <label>Address</label>
            <textarea class="form-control" name="address" required></textarea>
          </div>
          <div class="form-group">
            <label>Phone</label>
            <input type="text" name="phone" class="form-control" required>
          </div>
        </div>
        <div class="modal-footer">
          <input type="button" class="btn btn-default" data-dismiss="modal" value="Cancel">
          <input type="submit" class="btn btn-success" value="Update">
        </div>
      </form>
      </form>
    </div>
  </div>
</div>
<!-- Delete Modal HTML -->
{{!-- <div id="deleteStudentModal" class="modal fade">
  <div class="modal-dialog">
    <div class="modal-content">
      <form>
        <div class="modal-header">
          <h4 class="modal-title">Delete Student</h4>
          <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
        </div>
        <div class="modal-body">
          <p>Are you sure you want to delete these Records?</p>
          <p class="text-warning"><small>This action cannot be undone.</small></p>
        </div>
        <div class="modal-footer">
          <input type="button" class="btn btn-default" data-dismiss="modal" value="Cancel">
          <input type="submit" class="btn btn-danger" value="Delete" id="deleteStudent">
        </div>
      </form>
    </div>
  </div>
</div> --}}

<script>
  $(document).ready(function () {
    var origin = window.location.origin;
    console.log(origin)
    $("#addStudentModalForm").on("submit", function (e) {
      e.preventDefault();
      var data = new FormData(this);
      //      data.append("profilePhoto", $("#profilePhoto")[0].files[0]);
      console.log(data);
      $.ajax({
        url: origin + "/students/add",
        method: "POST",
        data: data,
        cache: false,
        contentType: false,
        processData: false,
        success: function (result) {
          if (result.type == "success") {
          $("#addStudentModal").modal('hide');
            toastr.success(result.message)
            //            $("#addStudentModal", data).html(result)
            $("#studentList").load(origin + "/students/list");
          }
          if (result.type == "error")
            toastr.error(result.message)
        }
      });
    });
    $(".editModelShow").on("click", function () {
      let id = $(this).data("id");
      $.ajax({
        url: origin + "/students/" + id,
        method: "GET",
        success: function (result) {
          console.log(result)
          $('input[name="stdId').val(id);
          $('input[name="firstName"]').val(result.student.firstName);
          $('input[name="fatherName"]').val(result.student.fatherName);
          $('input[name="motherName"]').val(result.student.motherName);
          $(`input:radio[name="gender"][value=${result.student.gender}]`).prop("checked", true);
          $('img[name="profilePhoto"]').attr("src", "/uploads/user-avatar/" + result.student
            .profilePhoto);
          $('textarea[name="address"]').val(result.student.address);
          $('textarea[name="address"]').text(result.student.address);
          $('input[name="phone"]').val(result.student.phone);

        }
      });
    });
    $("#editStudentModalForm").on("submit", function (e) {
      e.preventDefault();
      let id = $('input[name="stdId').val();
      var data = new FormData(this);
      if ($("#profilePhoto2")[0].files[0]) {
        data.delete("profilePhoto");
        console.log($("#profilePhoto2")[0].files[0])
        data.append("profilePhoto", $("#profilePhoto2")[0].files[0]);
      }
      console.log(data);
      $.ajax({
        url: origin + "/students/" + id,
        method: "PUT",
        data: data,
        cache: false,
        contentType: false,
        processData: false,
        success: function (result) {
          $("#editStudentModal").modal('hide');
          if (result.type == "success") {
            toastr.success(result.message)
            $("#studentList").load(origin + "/students/list");
          }
          //window.location = origin + "/students/list";
        },
        error: function (err) {
          toastr.error(err.message)
        }
      });
    });
    // Delete single
    $(".deleteModelShow").on("click", function () {
      let id = $(this).data("id");
      swal({
          title: "Are you sure?",
          text: "Once deleted, you will not be able to recover this imaginary file!",
          icon: "warning",
          buttons: true,
          dangerMode: true,
        })
        .then((willDelete) => {
          if (willDelete) {
            $.ajax({
              url: origin + "/students/" + id,
              method: "DELETE",
              processData: false,
              success: function (result) {
                if (result.type == "success") {
                  //$(".row" + id).hide()
                  swal("Poof! Your imaginary file has been deleted!", {
                    icon: "success",
                  });
                  $("#studentList").load(origin + "/students/list");
                }
                if (result.type == "error")
                  toastr.error(result.message)
                //window.location = origin + "/students/list";
              }
            });
          } else {
            swal("Your Data is safe!");
          }
        });
    });
    $("#selectAll").on("change", () => {
      $(".deleteAll").prop("checked", $(".deleteAll").prop("checked"));

    })
    // Delete Multiple
    $(".deleteStudentModal").on("click", function () {
      let ids = [];
      $("input[class='deleteAll']:checked").each(function () {
        ids.push(this.value);
      });
      console.log(ids)
      swal({
          title: "Are you sure?",
          text: "Once deleted, you will not be able to recover this imaginary file!",
          icon: "warning",
          buttons: true,
          dangerMode: true,
        })
        .then((willDelete) => {
          if (willDelete) {
            $.ajax({
              url: origin + "/students/deleteMany/",
              data: JSON.stringify(ids),
              contentType: 'application/json',
              method: "DELETE",
              success: function (result) {
                if (result.type == "success") {
                  // $(".row" + ids).hide()
                  swal("Poof! Your imaginary file has been deleted!", {
                    icon: "success",
                  });
                  $("#studentList").load(origin + "/students/list");
                }
                if (result.type == "error")
                  toastr.error(result.message)
                //window.location = origin + "/students/list";
              }
            });
          } else {
            swal("Your Data is safe!");
          }
        });
    });
  });
</script>